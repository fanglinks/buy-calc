<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>我怎么就是管不住这手呢？ - 日系剁手网站综合价格对比工具</title>
    <link rel="shortcut icon" href="favicon.ico?20160822" />
    <script src="build/react.js"></script>
    <script src="build/react-dom.js"></script>
    <script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
    <script type="text/javascript">
    Number.parseInt = window.parseInt;
    Number.parseFloat = window.parseFloat;
    Number.isNaN = window.isNaN;
    var app={
      exchange: 0.06,
      set_exchange: function (exchange) {
        this.exchange = exchange.rates['CNY'];
      },
      itemKinds: [{
        id: 0,
        name: '漫画单行本/小说/大型本/画集写真',
      },{
        id: 1,
        name: '杂志',
      },{
        id: 2,
        name: 'DVD/CD/BD/光盘游戏',
      },{
        id: 3,
        name: '玩具、模型',
      },{
        id: 99,
        name: '其他',
      }],
      generalPrices: {
        'EMS': function (weight) {
          'use strict';
          if(weight<=500)
            return 1400;
          if(weight<=600)
            return 1540;
          if(weight<=700)
            return 1680;
          if(weight<=800)
            return 1820;
          if(weight<=900)
            return 1960;
          if(weight<=1000)
            return 2100;
          if(weight<=1250)
            return 2400;
          if(weight<=1500)
            return 2700;
          if(weight<=1750)
            return 3000;
          if(weight<=5500){
            let singlePrice = [3300,3800,4300,4800,5300,5800,6300,6800];
            return singlePrice[Math.ceil(weight/500)-4];
          }
          if(weight<=30000){
            let singlePrice = [7300,8100,8900,9700,10500,11300,12100,12900
              ,13700,14500,15300,16100,16900,17700,18500,19300,20100,20900,21700,22500,23300,24100,24900,25700,26500];
            return singlePrice[Math.ceil(weight/1000)-6];
          }
        },
        'SAL': function (weight) {
          var singlePrice = [1800,2400,3000,3600,4200,4700,5200,5700,6200,6700
            ,7000,7300,7600,7900,8200,8500,8800,9100,9400,9700,10000,10300,10600
            ,10900,11200,11500,11800,12100,12400,12700]
          return singlePrice[Math.ceil((weight == 0 ? 1 : weight)/1000)-1];
        },
        'AIR': function (weight) {
          'use strict';
          if(weight<=10000){
            let singlePrice=[1700,2050,2400,2750,3100,3450,3800,4150,4500
              ,4850,5150,5450,5750,6050,6350,6650,6950,7250,7550,7850];
            return singlePrice[Math.ceil((weight <= 0 ? 1 : weight)/500)-1]
          }
          let singlePrice=[8250,8650,9050,9450,9850,10250,10650,11050,11450
            ,11850,12250,12650,13050,13450,13850,14250,14650,15050,15450,15850];
          return singlePrice[Math.ceil(weight/1000)-11];
        },
        'mSAL': function (weight) {
          'use strict';
          var singlePrice = [160,240,320,400,480,560,640,720,800,880,960,1040,1120,1200,1280,1360,1440,1520,1600,1680];
          return singlePrice[Math.ceil((weight <= 0 ? 1 : weight)/100)-1];
        },
        'mAIR': function (weight) {
          'use strict';
          if(weight<=1000){
            let singlePrice = [120,190,260,330,400,470,540,610,680,750,820,890,960,1030,1100,1170,1240,1310,1380,1450];
            return singlePrice[Math.ceil((weight <= 0 ? 1 : weight)/50)-1];
          }
          let singlePrice = [1625,1800,1975,2150];
          return singlePrice[Math.ceil(weight/250)-5];
        },
        'SHIP': function (weight) {
          'use strict';
          let singlePrice = [1600,1900,2200,2500,2800,3100,3400,3700,4000,4300,4550,4800,5050,5300,5550,5800,6050,6300,6550,6800,7050,7300,7550,7800,8050,8300,8550,8800,9050,9300];
          return singlePrice[Math.ceil((weight <= 0 ? 1 : weight)/1000)-1];
        }
      },
      shoppingSite: [{
        id: 0,
        name: '萌购',
        itemremark: '(商品价格* 8%（+日本国内运费）)* 支付宝汇率[1] + 代购手续费 0%~6%',
        itemprice: function (price) {
          return Math.ceil(price*1.08*app.exchange*1.03);
        },
        japanShipmentPrice: function (shipment) {
          return Math.ceil(shipment*app.exchange*1.03);
        },
        otherBuyFees: [{
          id: 0,
          name: '代购手续费',
          input_type: 'text',
          input_calc: function (elem) {
            return Number.parseInt(elem.value) ? Number.parseInt(elem.value) : 0;
          },
          is_rmb: true,
        }],
        //重量计算
        weightCalc: function (weight) {
          return Math.ceil(weight/50)*50;
        },
        //包装计算器
        wrapperCalc: function (weight) {
          if(weight<=3000)
            return 300;
          return weight*0.1;
        },
        methods: [{
          id: 0,
          name: '萌购团发',
          price: function (weight,itemKind) {
            //设定单价
            var singlePrice = [3,2.5,3,3];
            singlePrice[99] = 5;

            return Math.ceil(Math.ceil(weight/50)*singlePrice[itemKind]);
          },
          remark: '物品重量/50g*团发单价',
          chinaMethod: [{

          }],
          total: function (items) {
            var that = this;//萌购团发对象
            return items.reduce(function (previous,current) {
              return previous + that.price(current.weight,current.itemKind);
            },0);
          },
        },{
          id: 1,
          name: '萌购直发（EMS）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[0].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['EMS'](weight)*app.exchange*1.03);
          },
          remark: '日本邮政EMS价格*支付宝汇率',
        },{
          id: 2,
          name: '萌购直发（SAL）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[0].wrapperCalc(weight);//0 is 030buy's id
            return Math.ceil(app.generalPrices['SAL'](weight)*1.1*app.exchange*1.03);
          },
          remark: '日本邮政SAL价格*1.1包装手续费*支付宝汇率',
        },{
          id: 3,
          name: '萌购直发（AIR）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[0].wrapperCalc(weight);//0 is 030buy's id
            return Math.ceil(app.generalPrices['AIR'](weight)*1.1*app.exchange*1.03);
          },
          remark: '日本邮政AIR价格*1.1包装手续费*支付宝汇率',
        },{
          id: 4,
          name: '萌购国际小包',
          price: function (weight) {
            weight += app.shoppingSite[0].wrapperCalc(weight);//0 is 030buy's id
            if(weight<=500){
              return 30;
            }
            return Math.ceil((weight-500)/100)*5+30;
          },
          remark: '萌购国际小包价格'
        },{
          id: 5,
          name: '香港邮政E特快',
          price: function (weight) {
            //设定单价
            var singlePrice = [60,85,110,135,160,185,210,235,260,285,310,335,360];

            weight += app.shoppingSite[0].wrapperCalc(weight);//0 is 030buy's id
            return singlePrice[(Math.ceil((weight<=500 ? 501 : weight)/500)-2)];
          },
          remark: '萌购E特快价格'
        }],
        accordings: [{
          key: '费用构成/代购手续费',
          value: 'http://www.030buy.net/help/article?article_id=31',
          newWindow: true
        },{
          key: '团发运费',
          value: 'http://www.030buy.net/help/article?article_id=30',
          newWindow: true
        },{
          key: '重量计算/包装重量计算 [2]',
          value: 'http://www.030buy.cc/help/article?article_id=34',
          newWindow: true
        }]
      },{                                                                        // 030buy end masadora start
        id: 1,
        name: '玛莎多拉',
        itemremark: '(商品价格*8%(+日本国内运费)+ 手续费(+2%保价费))* 支付宝汇率[1]',
        itemprice: function (price) {
          return Math.ceil(price*1.08*app.exchange*1.03);
        },
        japanShipmentPrice: function (shipment) {
          return Math.ceil(shipment*app.exchange*1.03);
        },
        otherBuyFees: [{
          id: 0,
          name: '代购手续费',
          input_type: 'text',
          input_calc: function (elem) {
            return Number.parseInt(elem.value) ? Number.parseInt(elem.value)*app.exchange*1.03 : 0;
          },
          is_rmb: false,
        },{
          id: 1,
          name: '保价费',
          default_value: false,
          input_type: 'checkbox',
          input_calc: function (elem,item) {
            return elem.checked ? Math.ceil(item.price*0.02)*app.exchange*1.03 : 0;
          },
          is_rmb: false,
        }],
        //重量计算
        weightCalc: function (weight) {
          return Math.ceil(weight/50)*50;
        },
        //包装计算器
        wrapperCalc: function (weight) {
          if(weight<=1000)
            return 200;
          return weight*0.2;
        },
        methods: [{
          id: 0,
          name: '玛莎直发拼团',
          price: function (weight,itemKind) {
            return 0;
          },
          otherType: 'text',
          other_input_calc: function (elem,item) {
            return Number.parseFloat(elem.value)*Math.ceil(item.weight/50);
          },
          otherUnit: '元/50g',
          remark: '物品重量*直发拼团单价',
          chinaMethod: [{

          }]
        },{
          id: 1,
          name: '玛莎直发（EMS）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[1].wrapperCalc(weight);//1 is masadora's id
            return Math.ceil(app.generalPrices['EMS'](weight)*1.1*app.exchange*1.03);
          },
          remark: '日本邮政EMS价格*1.1包装手续费*支付宝汇率',
        },{
          id: 2,
          name: '玛莎直发（SAL）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[1].wrapperCalc(weight);//1 is masadora's id
            return Math.ceil(app.generalPrices['SAL'](weight)*1.1*app.exchange*1.03);
          },
          remark: '日本邮政SAL价格*1.1包装手续费*支付宝汇率',
        },{
          id: 3,
          name: '玛莎直发（AIR航空便）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[1].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['AIR'](weight)*1.1*app.exchange*1.03);
          },
          remark: '日本邮政AIR价格*1.1包装手续费*支付宝汇率',
        },{
          id: 4,
          name: '玛莎直发（SAL小型包裹）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[1].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['mSAL'](weight)*1.1*app.exchange*1.03);
          },
          remark: '日本邮政小型包裹SAL价格*1.1包装手续费*支付宝汇率',
        },{
          id: 5,
          name: '玛莎直发（AIR小型包裹）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[1].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['mAIR'](weight)*1.1*app.exchange*1.03);
          },
          remark: '日本邮政小型包裹AIR价格*1.1包装手续费*支付宝汇率',
        },{
          id: 6,
          name: '玛莎直发（海运）',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[1].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['SHIP'](weight)*1.2*app.exchange*1.03);
          },
          remark: '海运*1.2包装手续费*支付宝汇率',
        }],
        accordings: [{
          key: '费用构成/包装手续费',
          value: 'http://www.masadora.net/help/%E8%B4%AD%E7%89%A9%E6%8C%87%E5%8D%97-%E8%B4%B9%E7%94%A8%E6%9E%84%E6%88%90.htm',
          newWindow: true
        },{
          key: '重量计算/包装重量计算 [3]',
          value: 'http://www.masadora.net/help/%E5%8F%91%E9%80%81%E8%AF%B4%E6%98%8E-%E5%8F%91%E9%80%81%E6%96%B9%E5%BC%8F.htm',
          newWindow: true
        }]
      },{                                                                          //masadora end 任你购start
        id: 2,
        name: '任你购',
        itemremark: '(商品价格* 8%（+日本国内运费）)* 支付宝汇率[1] (+ 代购手续费 5%)',
        itemprice: function (price) {
          return Math.ceil(price*1.08*app.exchange*1.03);
        },
        japanShipmentPrice: function (shipment) {
          return Math.ceil(shipment*app.exchange*1.03);
        },
        otherBuyFees: [{
          id: 0,
          name: '代购手续费',
          input_type: 'text',
          input_calc: function (elem) {
            return Number.parseInt(elem.value) ? Number.parseInt(elem.value) : 0;
          },
          is_rmb: true,
        }],
        //重量计算
        weightCalc: function (weight) {
          return Math.ceil(weight/50)*50;
        },
        //包装计算器
        wrapperCalc: function (weight) {
          if(weight<=3000)
            return 300;
          return weight*0.1;
        },
        methods: [{
          id: 0,
          name: 'EMS',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[2].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['EMS'](weight)*app.exchange*1.03);
          },
          remark: 'EMS价格*支付宝汇率',
        },{
          id: 1,
          name: 'SAL',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[2].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['SAL'](weight)*1.1*app.exchange*1.03);
          },
          remark: 'SAL价格*1.1包装手续费*支付宝汇率',
        },{
          id: 2,
          name: 'AIR',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[2].wrapperCalc(weight);
            return Math.ceil(app.generalPrices['AIR'](weight)*1.1*app.exchange*1.03);
          },
          remark: 'AIR价格*1.1包装手续费*支付宝汇率',
        },{
          id: 3,
          name: '萌购国际小包',
          price: function (weight) {
            weight += app.shoppingSite[2].wrapperCalc(weight);
            if(weight<=500){
              return 30;
            }
            return Math.ceil((weight-500)/100)*5+30;
          },
          remark: '萌购国际小包价格'
        },{
          id: 4,
          name: '香港邮政E特快',
          price: function (weight) {
            //设定单价
            var singlePrice = [60,85,110,135,160,185,210,235,260,285,310,335,360];

            weight += app.shoppingSite[0].wrapperCalc(weight);//0 is 030buy's id
            return singlePrice[(Math.ceil((weight<=500 ? 501 : weight)/500)-2)];
          },
          remark: '萌购E特快价格'
        },{
          id: 5,
          name: 'SAL小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[2].wrapperCalc(weight);
            return Math.ceil((app.generalPrices['mSAL'](weight)+200)*app.exchange*1.03);
          },
          remark: '小型包裹SAL价格*1.1包装手续费*支付宝汇率',
        },{
          id: 6,
          name: 'AIR小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[2].wrapperCalc(weight);
            return Math.ceil((app.generalPrices['mAIR'](weight)+200)*app.exchange*1.03);
          },
          remark: '小型包裹AIR价格*1.1包装手续费*支付宝汇率',
        }],
        accordings: [{
          key: '费用构成/代购手续费',
          value: 'http://rennigou.jp/help/01_03',
          newWindow: true
        }],
      },{                                                                                         //任你购end 2poi start
        id: 3,
        name: '2poi',
        itemremark: '(商品价格* 8%（+日本国内运费）)* 汇率*1.04（国际结算手续费）(+代购手续费 5%)',
        itemprice: function (price) {
          return Math.ceil(price*1.08*app.exchange*1.04);
        },
        japanShipmentPrice: function (shipment) {
          return Math.ceil(shipment*app.exchange*1.04);
        },
        otherBuyFees: [{
          id: 0,
          name: '代购手续费',
          input_type: 'text',
          input_calc: function (elem) {
            return Number.parseInt(elem.value) ? Number.parseInt(elem.value) : 0;
          },
          is_rmb: true,
        }],
        //重量计算
        weightCalc: function (weight) {
          return weight;
        },
        //包装计算器
        wrapperCalc: function (weight) {
          return 0;
        },
        methods: [{
          id: 0,
          name: 'EMS',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['EMS'](weight)*app.exchange*1.04*1000)/1000;//处理总体以日元结算的费用时，精确到小数点后3位
          },
          remark: 'EMS价格*汇率*1.04（国际结算手续费）',
        },{
          id: 1,
          name: 'SAL',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['SAL'](weight)*1.1*app.exchange*1.04*1000)/1000;
          },
          remark: 'SAL价格*1.1包装手续费*汇率*1.04（国际结算手续费）',
        },{
          id: 2,
          name: 'AIR',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['AIR'](weight)*1.1*app.exchange*1.04*1000)/1000;
          },
          remark: 'AIR价格*1.1包装手续费*汇率*1.04（国际结算手续费）',
        },{
          id: 3,
          name: 'SAL小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round((app.generalPrices['mSAL'](weight)+200)*app.exchange*1.04*1000)/1000;
          },
          remark: '（小型包裹SAL价格+200日元）*汇率*1.04（国际结算手续费）',
        },{
          id: 4,
          name: 'AIR小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round((app.generalPrices['mAIR'](weight)+200)*app.exchange*1.04*1000)/1000;
          },
          remark: '（小型包裹AIR价格+200日元）*汇率*1.04（国际结算手续费）',
        }],
        accordings: [{
          key: '费用构成/代购手续费/国际结算手续费',
          value: 'http://2poi.jp/help/02_03',
          newWindow: true
        },{
          key: '2poi备注',
          value: '#according-4'
        }],
      },{                                                                                         //2poi end fromJapan start
        id: 4,
        name: 'fromJapan',
        itemremark: '（商品价格*8%（+日本国内运费）)*汇率[5]*1.05（系统使用费）',
        itemprice: function (price) {
          return Math.round(price*1.08*app.exchange*1.05*1000)/1000;
        },
        japanShipmentPrice: function (shipment) {
          return Math.round(shipment*app.exchange*1.05*1000)/1000;
        },
        otherBuyFees: [],
        //重量计算
        weightCalc: function (weight) {
          return weight;
        },
        //包装计算器
        wrapperCalc: function (weight) {
          return 0;
        },
        methods: [{
          id: 0,
          name: 'EMS',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['EMS'](weight)*app.exchange*1.05*1000)/1000;
          },
          remark: 'EMS价格*1.05（系统使用费）',
        },{
          id: 1,
          name: 'SAL',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['SAL'](weight)*app.exchange*1.05*1000)/1000;
          },
          remark: 'SAL价格*1.05（系统使用费）',
        },{
          id: 2,
          name: 'AIR',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['AIR'](weight)*app.exchange*1.05*1000)/1000;
          },
          remark: 'AIR价格*1.05（系统使用费）',
        },{
          id: 3,
          name: 'SAL小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['mSAL'](weight)*app.exchange*1.05*1000)/1000;
          },
          otherType: 'checkbox',//410日元挂号服务
          other_input_calc: function (elem,item) {
            if(elem.checked)
              return Math.round(410*app.exchange*1.05*1000)/1000;
            return 0;
          },
          otherUnit: '410日元挂号服务',
          remark: '小型包裹SAL价格*1.05（系统使用费）',
        },{
          id: 4,
          name: 'AIR小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['mAIR'](weight)*app.exchange*1.05*1000)/1000;
          },
          otherType: 'checkbox',//410日元挂号服务
          other_input_calc: function (elem,item) {
            if(elem.checked)
              return Math.round(410*app.exchange*1.05*1000)/1000;
            return 0;
          },
          otherUnit: '410日元挂号服务',
          remark: '小型包裹AIR价格*1.05（系统使用费）',
        }],
        accordings: [{
          key: '费用构成',
          value: 'http://www.fromjapan.co.jp/cn/title/charge',
          newWindow: true
        },{
          key: 'fromJapan备注',
          value: '#according-6'
        }],
      },{                                                                                         //fromJapan end cdJapan start
        id: 5,
        name: 'cdJapan',
        itemremark: '商品价格*汇率[5]',
        itemprice: function (price) {
          return Math.round(price*app.exchange*1000)/1000;
        },
        japanShipmentPrice: function (shipment) {
          return Math.round(shipment*app.exchange*1000)/1000;
        },
        otherBuyFees: [],
        //重量计算
        weightCalc: function (weight) {
          return weight;
        },
        //包装计算器
        wrapperCalc: function (weight) {
          return 0;
        },
        methods: [{
          id: 0,
          name: 'EMS',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['EMS'](weight)*app.exchange*1000)/1000;
          },
          remark: 'EMS价格',
        },{
          id: 1,
          name: 'SAL小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['mSAL'](weight)*app.exchange*1000)/1000;
          },
          otherType: 'checkbox',//410日元挂号服务
          other_input_calc: function (elem,item) {
            if(elem.checked)
              return Math.round(410*app.exchange*1000)/1000;
            return 0;
          },
          otherUnit: '410日元挂号服务',
          remark: '小型包裹SAL价格',
        },{
          id: 2,
          name: 'AIR小型包裹',
          price: function (weight) {
            //包装计算
            weight += app.shoppingSite[3].wrapperCalc(weight);
            return Math.round(app.generalPrices['mAIR'](weight)*app.exchange*1000)/1000;
          },
          otherType: 'checkbox',//410日元挂号服务
          other_input_calc: function (elem,item) {
            if(elem.checked)
              return Math.round(410*app.exchange*1000)/1000;
            return 0;
          },
          otherUnit: '410日元挂号服务',
          remark: '小型包裹AIR价格',
        }],
        accordings: [{
          key: '运费计算',
          value: 'http://www.cdjapan.co.jp/guide/help/shipping/shipping_charge',
          newWindow: true
        },{
          key: 'cdJapan备注',
          value: '#according-7'
        }],
      }],                                                                       //shoppingSite end
      remarks: [{
        id: 1,
        words: '支付宝汇率：萌购与玛莎使用支付宝平台转换日元并以日元结算，支付宝需要支付3%国际结算手续费，即汇率*1.03，由于本站汇率实时更新，可能会与支付宝汇率相差0.5%',
        link:'https://global.alipay.com/product/websitepayment.htm'
      },{
        id: 2,
        words: '包装重量：萌购与玛莎与一些代购平台打包后会重新称重，并使用包装重量计算，此工具已计入包装重量'
      },{
        id: 3,
        words: '玛莎多拉的包装计算方式为：少于1000g为200g，大于1000g为20%'
      },{
        id: 4,
        words: '2poi的虎穴无代购手续费与日本国内运费，其他网站代购手续费正实行免费，代购手续费一栏可以保持为0。2poi的重量计算为实际重量计算，因此，包裹的重量为实际重量，实际的2poi国际运费会比计算器中的费用略大，请知悉。'
      },{
        id:5,
        words: '汇率：银行卡汇率，各银行不同（即时购汇），使用信用卡支付时也有可能会被银行收取货币转换费，计算器使用的汇率为当前实时汇率，因此可能会比真实费用少，请向发卡行咨询更多信息。'
      },{
        id: 6,
        words: 'fromJapan重量同2poi为实际重量，计算器所算得包裹重量与运费未计入包装。fromJapan存在会员等级折扣，由FJ点数支付的部分也免除5%系统使用费，暂时未提供计算。'
      },{
        id: 7,
        words: '计算重量为实际重量，包装重量约为30~100g。cdJapan的小型SAL与AIR与实际付款可能存在50日元+的误差，请以官方计算器为准。'
      }],
      cart:[],
    };
    </script>
  </head>
  <body>
    <div id="react-main">

    </div>
    <script type="text/babel">
    var realTimeStorage = {};//{ methodid: {japanShipment: japanShipment}}


    var ShippingMethods = React.createClass({
      getInitialState: function () {
        return {};
      },
      handleOtherInput: function (event) {
        var updateState = {};
        var method_id = event.target.name;

        updateState[method_id] = event.target;
        this.setState(updateState);
      },
      render: function () {
        var item = this.props.item;
        var otherInputState = this.state;
        var japanPrice = this.props.japanPrice;
        var that = this;
        return <div>
            {
              this.props.methods.map(function (method) {
                var internationPrice = method.price(item.weight,item.itemKind);//普通计算
                if(otherInputState[method.id])
                  internationPrice += method.other_input_calc(otherInputState[method.id],item);//基于输入
                if(method.other_price_base_calc)
                  internationPrice += method.other_price_base_calc(internationPrice);//基于已付款
                internationPrice = Math.ceil(internationPrice); //处理以日元结算的整体取整

                var radioValue = that.props.siteid+'-'+method.id;
                //设定各物流的日本方面价格
                realTimeStorage[radioValue] = {
                  japanPrice: japanPrice,
                };

                return <div key={method.id}>
                  <span>
                    <label><input type="radio" name="ship" value={radioValue} />{method.name}</label>
                    {//玛莎或者其他可能的扩展 直发拼团可自定义运费
                      (method.otherType&&method.otherType!='hidden') ?
                      <span><input type={method.otherType} name={method.id} onChange={that.handleOtherInput} />{method.otherUnit}</span> :
                      ''
                    }
                    <span>{Number.isNaN(internationPrice) ? ' 超重啦！不能运送哦！' : ' => '+internationPrice+' 元 '}</span>
                    {
                      method.chinaMethod ?
                        <span>
                        此发送方式还需要支付国内运费，暂时无法将国内运费加入比较，请等待版本更新
                          {
                            Number.isNaN(internationPrice) ? '' : <span> 总约：{japanPrice + internationPrice}元</span>
                          }
                        </span> :
                        (Number.isNaN(internationPrice) ? '' : <span> 总约：{japanPrice + internationPrice}元</span>)
                    }
                    <p>计算公式： {method.remark}</p>
                  </span>
                </div>
              })
            }
        </div>
      }
    });


    //ShoppingSite与ShoppingCartSite通用
    function getRealItem(item) {
      var itemCopy = {};
      for (var key in item) {
        if (item.hasOwnProperty(key)) {
          itemCopy[key]=item[key];
        }
      }
      //获得网站特定item
      //获得计算重量
      itemCopy.weight = this.props.site.weightCalc(itemCopy.weight);
      return itemCopy;
    }


    var ShoppingSite = React.createClass({
      getRealItem: getRealItem,
      getInitialState: function () {
        return {};
      },
      handleOtherBuyFeesInput: function (event) {
        var otherBuyFee = {};
        var otherBuyFee_id = event.target.name;
        otherBuyFee[otherBuyFee_id] = event.target;
        this.setState(otherBuyFee);
      },
      render: function () {
        var that = this;
        var item = this.getRealItem(this.props.item);
        var site = this.props.site;
        var japanShipmentPrice = site.japanShipmentPrice ? site.japanShipmentPrice(item.japanShipment) : 0;

        var japanPrice = //日本方面运费（人民币）
        site.itemprice(item.price) //价格
        + japanShipmentPrice; //日本国内运费
        for (var key in this.state) {//其他费用（来自输入）
          if (this.state.hasOwnProperty(key)) {
            japanPrice += site.otherBuyFees[key].input_calc(this.state[key],item);
          }
        }
        for (var i = 0; i < site.otherBuyFees.length; i++) {//其他费用（基于已付款费用）
          if(site.otherBuyFees[i].input_type=='hidden')
            japanPrice += site.otherBuyFees[i].input_calc(null,item);
        }
        japanPrice = Math.ceil(japanPrice);//对以日元计算的商品整体取整
        return <tr>
            <td>{site.name}</td>
            <td>
              <p>{item.price ? item.price : 0}日元
              { //日本国内运费
                japanShipmentPrice ?
                ' + '+ item.japanShipment+'日元 ' : ''
              }
              { //其他可能的手续费等费用
                Array.isArray(site.otherBuyFees) ?
                site.otherBuyFees.map(function (otherBuyFee) {
                  var insert =
                  (()=>{switch (otherBuyFee.input_type) {
                    case 'text':
                      return <span>
                        <input type='text'
                               name={otherBuyFee.id}
                               defaultValue={otherBuyFee.default_value}
                               onChange={that.handleOtherBuyFeesInput}
                               placeholder={otherBuyFee.name} />{otherBuyFee.is_rmb ? '元 ':'日元 '}
                      </span>;
                      break;
                    case 'checkbox':
                      return <label>
                        <input type='checkbox'
                               defaultChecked={otherBuyFee.default_value}
                               name={otherBuyFee.id}
                               onChange={that.handleOtherBuyFeesInput} />{otherBuyFee.name}
                      </label>;
                      break;
                    case 'hidden':
                      return null;
                    default:
                      return '看到这个说明你药丸！';
                      break;
                    }
                  })();
                  return <span key={otherBuyFee.id}>{otherBuyFee.input_type!='hidden' ? ' + ' : null}
                  {
                    insert
                  }
                  </span>
                }) : null
              }
              => {japanPrice}元</p>
              <p>计算公式：{site.itemremark}</p>
            </td>
            <td>
              <ShippingMethods methods={site.methods} item={item} japanPrice={japanPrice} siteid={site.id} />
            </td>
            <td>
            { //根据
              site.accordings.map(function (according) {
                return <p key={according.key}><a href={according.value} target={according.newWindow ? '_blank': null}>{according.key}</a></p>
              })
            }
            </td>
          </tr>
      }
    });



    var ShoppingCart = React.createClass({
      render: function () {
        var cart = this.props.cart;
        var methods = this.props.sites.reduce(function (previous,current) {
          return previous.concat(current.methods.map(function (method) {
            method.siteid=current.id;
            return method;
          }));
        },[]);
        var that = this;
        return <div className="cart-wrapper">
        {
          methods.map(function (method) {
            var shipid = method.siteid+'-'+method.id;
            var cartItems = cart.reduce(function (previous,cartItem) {
              return cartItem.shipid==shipid ? previous.concat(cartItem) : previous;
            },[]);
            if(cartItems.length <=0 ) return null;
            return <ShoppingCartSite key={method.siteid+'-'+method.id} site={that.props.sites[method.siteid]} methodid={method.id} cartItems={cartItems}/>;
          })
        }
        </div>
      }
    });



    var ShoppingCartSite = React.createClass({//虽然是Site但以物流的方式分类
      getRealItem: getRealItem,
      getTotalItem: function (items) {
        var that = this;
        items = items.map(function (item) {
          return that.getRealItem(item);
        });
        var item = items.reduce(function (previous,current) {
          return {
            japanPrice: (previous.japanPrice + current.japanPrice),
            weight: (previous.weight + current.weight),
            itemKind: current.itemKind,
          };
        });
        item.weight += this.props.site.wrapperCalc(item.weight);
        return item;
      },
      getTotalInterNational: function (method,items) {
        if(method.total){//发送方法自定义total方法的情况下，注意，items没有经过任何处理
          return method.total(items);
        }
        var item = this.getTotalItem(items);
        var internationPrice = method.price(item.weight,item.itemKind);//普通计算
        if(this.state.otherInputTarget)
          internationPrice += method.other_input_calc(this.state.otherInputTarget,item);//基于输入
        if(method.other_price_base_calc)
          internationPrice += method.other_price_base_calc(internationPrice);//基于已付款
        internationPrice = Math.ceil(internationPrice); //以日元结算的整体取整
        return internationPrice;
      },
      getInitialState: function () {
        return {};
      },
      handleOtherInput: function (event) {
        var updateState = {};
        var method_id = event.target.name;

        updateState['otherInputTarget'] = event.target;
        this.setState(updateState);
      },
      render: function () {
        var that = this;
        var methodid = this.props.methodid;
        var method = this.props.site.methods[methodid];
        var totalWeight = this.getTotalItem(this.props.cartItems).weight;
        var totalInterNational =  this.getTotalInterNational(method,this.props.cartItems);
        return <ul>
          <li>{this.props.site.name} - {method.name}</li>
          {
            this.props.cartItems.map(function (item) {
              var cartItem = that.getRealItem(item);
              return <li key={cartItem.id}>
                <span>{cartItem.japanPrice}</span>
                <span>{cartItem.weight}g</span>
              </li>
            })
          }
          <li>
          {//玛莎或者其他可能的扩展 直发拼团可自定义运费
            (method.otherType&&method.otherType!='hidden') ?
            <span><input type={method.otherType} name={method.id} onChange={this.handleOtherInput} />{method.otherUnit}</span> :
            null
          }
          {
            method.chinaMethod ?
              <span>
              此发送方式还需要支付国内运费，暂时无法将国内运费加入比较，请等待版本更新
              </span> : null
          }
          </li>
          <li>
            合计重量：{totalWeight+'g '}
            每50g运费：{Math.round(totalInterNational/totalWeight*50*100)/100+'元 '}
            合计运费：{totalInterNational+'元 '}
          </li>
        </ul>;
      }
    });



    var MainApp = React.createClass({
      getInitialState: function () {
        return {
          price: '',
          weight: '',
          japanShipment: '',
          itemKind: 99,
        }
      },
      calc: function (event) {
        var item = {};
        switch (event.target) {
          case this.refs.itempriceInput:
            item.price = Number.parseInt(event.target.value) ? Number.parseInt(event.target.value) : 0;
            break;
          case this.refs.japanShipmentInput:
            item.japanShipment = Number.parseInt(event.target.value) ? Number.parseInt(event.target.value) : 0;
            break;
          case this.refs.itemweightInput:
            item.weight = Number.parseInt(event.target.value) ? Number.parseInt(event.target.value) : 0;
            break;
          default://radio
            item.itemKind = event.target.value;
            break;
        }
        this.setState(item);
      },
      setShip: function (event) {
        if(event.target.name!='ship' && event.target.checked!=true)
          return;
        this.setState({
          shipid: event.target.value
        });
      },
      addToCart: function (event) {
        var item = this.state;
        var shipid = item.shipid;
        var cart = this.props.app.cart;
        var id = cart.length ? (cart[cart.length-1].id+1) : 0;

        this.props.app.cart.push({
          id: id,
          japanPrice: realTimeStorage[shipid].japanPrice,
          weight: item.weight,
          itemKind: item.itemKind,
          shipid: shipid,
        });
        //清空输入

        this.refs.shoppingCart.forceUpdate();
      },
      render: function () {
        var item = this.state;
        return <div className="app-wrapper">
          <form action="javascript:;" onChange={this.calc}>
            <div>
              <span>物品价格（不含税）：<input type="text" ref="itempriceInput" value={item.price}/>日元</span>
              <span>日本国内运费（税入）：<input type="text" ref="japanShipmentInput" value={item.japanShipment}/>日元</span>
              <span>物品重量：<input type="text" ref="itemweightInput" value={item.weight}/>g</span>
            </div>
            <div>
            {//选择物品种类
              this.props.app.itemKinds.map(function (itemKind) {
                return <label key={itemKind.id}>
                  <input type="radio" name="itemKind" value={itemKind.id} defaultChecked={item.itemKind==itemKind.id}/>
                  {itemKind.name}
                </label>
              })
            }
            </div>
            <span>当前汇率：{this.props.app.exchange}</span>
          </form>
          <div className="table-wrapper">
            <form action="javascript:;" onChange={this.setShip}>
              <table>
                <thead>
                  <tr>
                    <td>商家</td>
                    <td>商品价格</td>
                    <td>运送方法</td>
                    <td>根据</td>
                  </tr>
                </thead>
                <tbody>
                {
                  this.props.app.shoppingSite.map(function (site) {
                    return <ShoppingSite key={site.id}
                                         site={site}
                                         item={item} />
                  })
                }
                </tbody>
              </table>
            </form>
          </div>
          <div className="right add-cart"><button onClick={this.addToCart} disabled={ item.shipid==undefined||!item.price||!item.weight }>加入购物车</button></div>
          <ShoppingCart ref='shoppingCart' cart={this.props.app.cart} sites={this.props.app.shoppingSite} />
          <ol className="remark-wrapper">
          备注：
          {
            this.props.app.remarks.map(function (remark) {
              return <li key={remark.id} id={'according-'+remark.id}>{remark.words} {remark.link ? <a href={remark.link}>详情链接</a> : '' }</li>
            })
          }
          </ol>
        </div>
      }
    })
    ReactDOM.render(
      <MainApp app={app} />,
      document.getElementById('react-main')
    );
    </script>
    <script type="text/javascript" src="https://api.fixer.io/latest?base=JPY&symbols=CNY&callback=app.set_exchange"></script>
  </body>
</html>
